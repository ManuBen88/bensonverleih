<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Benson Verleih</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPbmjJRWdLVKO676Rv_WCLKioWuQwDzTo",
      authDomain: "bensonverleih.firebaseapp.com",
      projectId: "bensonverleih",
      storageBucket: "bensonverleih.firebasestorage.app",
      messagingSenderId: "778618205850",
      appId: "1:778618205850:web:4a9dd9b60b2fa8a1e9d123",
      measurementId: "G-T2CPLMWRP7"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    window.db = getFirestore(app);
  </script>
</head>
<body>
  <h1>Benson Verleih Kalender</h1>
  <div id="calendar"></div>
  <h2>Anfrage stellen</h2>
  <form id="requestForm">
    <label>Titel: <input name="title" required></label><br>
    <label>Startdatum: <input type="date" name="start" required></label><br>
    <label>Enddatum: <input type="date" name="end" required></label><br>
    <button type="submit">Anfragen</button>
  </form>
  <script type="module">
    async function loadEvents() {
      const snapshot = await getDocs(collection(window.db, 'events'));
      return snapshot.docs.map(doc => doc.data());
    }

    document.addEventListener('DOMContentLoaded', async function() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: async (info, success) => {
          const events = await loadEvents();
          success(events);
        }
      });
      calendar.render();

      document.getElementById('requestForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const data = {
          title: form.title.value,
          start: form.start.value,
          end: form.end.value
        };
        await addDoc(collection(window.db, 'events'), data);
        calendar.refetchEvents();
        form.reset();
      });
    });
  </script>
</body>
</html>
